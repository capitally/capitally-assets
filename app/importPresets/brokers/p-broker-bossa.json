{
  "version": 3,
  "type": "Capitally Data Export",
  "exportedAt": "2024-11-28T14:56:21.231Z",
  "data": {
    "importPresets": {
      "u-LXmULyLaqEYQW6N": {
        "id": "u-LXmULyLaqEYQW6N",
        "name": "Transactions & dividends #beta",
        "updatedAt": "2024-11-28T15:56",
        "author": "RL <iFIjgKg2M7TIe5ygfjFzaDEAlAX2>",
        "info": "To import your transactions from Bossa:\n\n1. Go to [Bossa](https://online.bossa.pl/bossaapp/login)\n2. Open **Portfel** ‚Üí **Historia finansowa** \n3. Set **Poka≈º** ‚Üí **Wszystkie**\n4. Choose time frame\n5. Select **Eksportuj do CSV**\n6. Click **Wykonaj** and save the file\n7. Open or drop that file here\n",
        "mappingInfo": "ü¶â If you previously imported transactions using the `Transakcje` table format, importing overlapping dates will create duplicate entries.",
        "sourceId": "p-broker-bossa",
        "provider": "Bossa",
        "providerIcon": {
          "type": "logo",
          "id": "brokers/bossa"
        },
        "providerGroup": "Brokers",
        "parser": {
          "dateOrder": "ymd",
          "decimalSeparator": "auto",
          "allowClipboard": false,
          "codepage": "windows-1250",
          "csv": {}
        },
        "sections": {
          "main": {
            "csv": {
              "header": true
            },
            "enabledColumns": ["data", "tytu≈Ç operacji", "szczeg√≥≈Çy", "kwota"],
            "program": {
              "stmts": [
                {
                  "type": "addAccount",
                  "optional": true,
                  "stmts": [
                    {
                      "type": "set",
                      "prop": "account.name",
                      "xpr": {
                        "type": "value",
                        "value": "Bossa"
                      }
                    },
                    {
                      "type": "set",
                      "prop": "account.icon",
                      "xpr": {
                        "type": "value",
                        "value": {
                          "type": "logo",
                          "id": "brokers/bossa"
                        }
                      }
                    },
                    {
                      "type": "set",
                      "prop": "account.countryISO",
                      "xpr": {
                        "type": "value",
                        "value": "PL"
                      }
                    }
                  ]
                },
                {
                  "type": "if",
                  "ifs": [
                    {
                      "xpr": {
                        "type": "pattern",
                        "xpr": {
                          "type": "prop",
                          "prop": "cols.tytu≈Ç operacji"
                        },
                        "pattern": "~Rozliczenie transakcji~^"
                      },
                      "stmts": [
                        {
                          "type": "comment",
                          "md": "## Transactions"
                        },
                        {
                          "type": "addTransaction",
                          "stmts": [
                            {
                              "type": "set",
                              "prop": "transaction.account",
                              "xpr": {
                                "type": "prop",
                                "prop": "addedAccount"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.asset",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.szczeg√≥≈Çy"
                              },
                              "trfms": [
                                {
                                  "type": "replace",
                                  "pattern": "/[- \\d.,]+ x .+/i$",
                                  "replace": ""
                                },
                                {
                                  "type": "replace",
                                  "pattern": "~-NC ~",
                                  "replace": " "
                                },
                                {
                                  "type": "trim"
                                }
                              ],
                              "cast": {
                                "asset": {
                                  "assetTypes": {
                                    "type": "value",
                                    "value": ["STOCK", "ETF"]
                                  },
                                  "markets": {
                                    "type": "value",
                                    "value": [
                                      {
                                        "id": "mic-XWAR"
                                      },
                                      {
                                        "id": "mic-XNAS"
                                      },
                                      {
                                        "id": "mic-XNYS"
                                      },
                                      {
                                        "id": "mic-XASE"
                                      },
                                      {
                                        "id": "mic-ARCX"
                                      },
                                      {
                                        "id": "mic-XETR"
                                      },
                                      {
                                        "id": "mic-XPAR"
                                      },
                                      {
                                        "id": "mic-XAMS"
                                      },
                                      {
                                        "id": "mic-XSWX"
                                      },
                                      {
                                        "id": "mic-XLIS"
                                      },
                                      {
                                        "id": "mic-XMIL"
                                      },
                                      {
                                        "id": "mic-XLON"
                                      },
                                      {
                                        "id": "mic-XFRA"
                                      },
                                      {
                                        "id": "mic-XBRU"
                                      },
                                      {
                                        "id": "mic-BMEX"
                                      },
                                      {
                                        "id": "mic-XTSE"
                                      },
                                      {
                                        "id": "mic-XTSX"
                                      }
                                    ]
                                  },
                                  "remote": {
                                    "type": "value",
                                    "value": true
                                  }
                                }
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.qty",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.szczeg√≥≈Çy"
                              },
                              "trfms": [
                                {
                                  "type": "extract",
                                  "pattern": "/([- \\d.,]+) x .+/i"
                                }
                              ]
                            },
                            {
                              "type": "set",
                              "prop": "transaction.price",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.szczeg√≥≈Çy"
                              },
                              "trfms": [
                                {
                                  "type": "extract",
                                  "pattern": "/ x ([- \\d.,]+)/i"
                                }
                              ]
                            },
                            {
                              "type": "set",
                              "prop": "transaction.valueCurrency",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.szczeg√≥≈Çy"
                              },
                              "trfms": [
                                {
                                  "type": "extract",
                                  "pattern": "/ x [- \\d.,]+ ([A-Z]{3}) nr/"
                                }
                              ]
                            },
                            {
                              "type": "set",
                              "prop": "transaction.feeCurrency",
                              "xpr": {
                                "type": "prop",
                                "prop": "transaction.valueCurrency"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.fee",
                              "xpr": {
                                "type": "formula",
                                "formula": "=abs(abs(Number(col(\"kwota\"))) - abs(transaction.price * transaction.qty))"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.reference",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.szczeg√≥≈Çy"
                              },
                              "trfms": [
                                {
                                  "type": "extract",
                                  "pattern": "/ nr ([A-Z0-9]+)/$"
                                }
                              ]
                            },
                            {
                              "type": "set",
                              "prop": "transaction.type",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.kwota"
                              },
                              "map": [
                                {
                                  "cmp": {
                                    "type": "<=",
                                    "v": {
                                      "type": "value",
                                      "value": "0"
                                    }
                                  },
                                  "target": {
                                    "type": "value",
                                    "value": "OPEN"
                                  }
                                },
                                {
                                  "target": {
                                    "type": "value",
                                    "value": "CLOSE"
                                  }
                                }
                              ]
                            },
                            {
                              "type": "set",
                              "prop": "transaction.date",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.data"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.note",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.szczeg√≥≈Çy"
                              }
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "xpr": {
                        "type": "pattern",
                        "xpr": {
                          "type": "prop",
                          "prop": "cols.tytu≈Ç operacji"
                        },
                        "pattern": "~Wyp≈Çata dywidendy~^"
                      },
                      "stmts": [
                        {
                          "type": "comment",
                          "md": "## Dividends"
                        },
                        {
                          "type": "addTransaction",
                          "stmts": [
                            {
                              "type": "set",
                              "prop": "transaction.account",
                              "xpr": {
                                "type": "prop",
                                "prop": "addedAccount"
                              }
                            },
                            {
                              "type": "var",
                              "varId": "symbol",
                              "varType": "scalar",
                              "multiple": false,
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.tytu≈Ç operacji"
                              },
                              "trfms": [
                                {
                                  "type": "replace",
                                  "pattern": "/Wyp≈Çata dywidendy( brutto| netto)? /^",
                                  "replace": ""
                                },
                                {
                                  "type": "replace",
                                  "pattern": "/\\d+% /",
                                  "replace": ""
                                },
                                {
                                  "type": "replace",
                                  "pattern": "/ (PLN|EUR|USD|GBP|CHF)/$",
                                  "replace": ""
                                }
                              ]
                            },
                            {
                              "type": "set",
                              "prop": "transaction.asset",
                              "xpr": {
                                "type": "prop",
                                "prop": "$symbol"
                              },
                              "trfms": [],
                              "cast": {
                                "asset": {
                                  "assetTypes": {
                                    "type": "value",
                                    "value": ["STOCK", "ETF"]
                                  },
                                  "markets": {
                                    "type": "value",
                                    "value": [
                                      {
                                        "id": "mic-XWAR"
                                      },
                                      {
                                        "id": "mic-XNAS"
                                      },
                                      {
                                        "id": "mic-XNYS"
                                      },
                                      {
                                        "id": "mic-XASE"
                                      },
                                      {
                                        "id": "mic-ARCX"
                                      },
                                      {
                                        "id": "mic-XETR"
                                      },
                                      {
                                        "id": "mic-XPAR"
                                      },
                                      {
                                        "id": "mic-XAMS"
                                      },
                                      {
                                        "id": "mic-XSWX"
                                      },
                                      {
                                        "id": "mic-XLIS"
                                      },
                                      {
                                        "id": "mic-XMIL"
                                      },
                                      {
                                        "id": "mic-XLON"
                                      },
                                      {
                                        "id": "mic-XFRA"
                                      },
                                      {
                                        "id": "mic-XBRU"
                                      },
                                      {
                                        "id": "mic-BMEX"
                                      },
                                      {
                                        "id": "mic-XTSE"
                                      },
                                      {
                                        "id": "mic-XTSX"
                                      }
                                    ]
                                  },
                                  "remote": {
                                    "type": "value",
                                    "value": true
                                  }
                                }
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.type",
                              "xpr": {
                                "type": "value",
                                "value": "DIVIDEND"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.date",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.data"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.value",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.kwota"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.note",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.tytu≈Ç operacji"
                              }
                            },
                            {
                              "type": "if",
                              "ifs": [
                                {
                                  "xpr": {
                                    "type": "pattern",
                                    "xpr": {
                                      "type": "prop",
                                      "prop": "cols.tytu≈Ç operacji"
                                    },
                                    "pattern": "/ (PLN|EUR|USD|GBP|CHF)/$"
                                  },
                                  "stmts": [
                                    {
                                      "type": "set",
                                      "prop": "transaction.valueCurrency",
                                      "xpr": {
                                        "type": "prop",
                                        "prop": "cols.tytu≈Ç operacji"
                                      },
                                      "trfms": [
                                        {
                                          "type": "extract",
                                          "pattern": "/[A-Z]{3}/i$"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "stmts": [
                                    {
                                      "type": "set",
                                      "prop": "transaction.valueCurrency",
                                      "xpr": {
                                        "type": "value",
                                        "value": {
                                          "id": "c-PLN"
                                        }
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "type": "lookupRows",
                              "direction": "start",
                              "stmts": [
                                {
                                  "type": "comment",
                                  "md": "**Search for tax withheld**"
                                },
                                {
                                  "type": "var",
                                  "varId": "lookupTitle",
                                  "varType": "scalar",
                                  "shared": false,
                                  "multiple": false,
                                  "xpr": {
                                    "type": "value",
                                    "value": "Podatek od odsetek lub dywidendy "
                                  }
                                },
                                {
                                  "type": "set",
                                  "prop": "$lookupTitle",
                                  "op": "append",
                                  "xpr": {
                                    "type": "prop",
                                    "prop": "$symbol"
                                  }
                                },
                                {
                                  "type": "if",
                                  "ifs": [
                                    {
                                      "xpr": {
                                        "type": "and",
                                        "xprs": [
                                          {
                                            "type": "=",
                                            "xpr": {
                                              "type": "prop",
                                              "prop": "lookup.cols.tytu≈Ç operacji"
                                            },
                                            "v": {
                                              "type": "prop",
                                              "prop": "$lookupTitle"
                                            }
                                          },
                                          {
                                            "type": "=",
                                            "xpr": {
                                              "type": "prop",
                                              "prop": "lookup.cols.data"
                                            },
                                            "v": {
                                              "type": "prop",
                                              "prop": "cols.data"
                                            }
                                          }
                                        ]
                                      },
                                      "stmts": [
                                        {
                                          "type": "set",
                                          "prop": "transaction.taxPaid",
                                          "xpr": {
                                            "type": "prop",
                                            "prop": "lookup.cols.kwota"
                                          },
                                          "trfms": [
                                            {
                                              "type": "abs"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "return",
                                          "levels": 1
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "type": "if",
                              "ifs": [
                                {
                                  "xpr": {
                                    "type": "pattern",
                                    "xpr": {
                                      "type": "prop",
                                      "prop": "cols.tytu≈Ç operacji"
                                    },
                                    "pattern": "~dywidendy netto~"
                                  },
                                  "stmts": [
                                    {
                                      "type": "comment",
                                      "md": "Dividend can be paid out with tax withheld. In such case, we calculate the WHT and *increase* the dividend value to brutto"
                                    },
                                    {
                                      "type": "var",
                                      "varId": "rate",
                                      "varType": "number",
                                      "multiple": false,
                                      "xpr": {
                                        "type": "prop",
                                        "prop": "cols.tytu≈Ç operacji"
                                      },
                                      "trfms": [
                                        {
                                          "type": "extract",
                                          "pattern": "/([0-9]+)%/"
                                        },
                                        {
                                          "type": "formula",
                                          "formula": "=x / 100"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "set",
                                      "prop": "transaction.value",
                                      "op": "/=",
                                      "xpr": {
                                        "type": "prop",
                                        "prop": "$rate"
                                      }
                                    },
                                    {
                                      "type": "set",
                                      "prop": "transaction.taxPaid",
                                      "op": "+=",
                                      "xpr": {
                                        "type": "formula",
                                        "formula": "=transaction.value * (1 - $rate)"
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "type": "addRowNote",
                              "note": {
                                "type": "value",
                                "value": "‚òùÔ∏è Bossa reports dividends under a different symbol then buy/sell transactions. Make sure they both refer to the same asset!"
                              }
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "xpr": {
                        "type": "or",
                        "xprs": [
                          {
                            "type": "pattern",
                            "xpr": {
                              "type": "prop",
                              "prop": "cols.tytu≈Ç operacji"
                            },
                            "pattern": "~Op≈Çata za~^"
                          },
                          {
                            "type": "pattern",
                            "xpr": {
                              "type": "prop",
                              "prop": "cols.tytu≈Ç operacji"
                            },
                            "pattern": "~Korekta ksiƒôgowa (op≈Çata za~^"
                          }
                        ]
                      },
                      "stmts": [
                        {
                          "type": "addTransaction",
                          "stmts": [
                            {
                              "type": "comment",
                              "md": "**Costs**"
                            },
                            {
                              "type": "set",
                              "prop": "transaction.asset",
                              "xpr": {
                                "type": "value",
                                "value": {
                                  "id": "c-PLN"
                                }
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.account",
                              "xpr": {
                                "type": "prop",
                                "prop": "addedAccount"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.type",
                              "xpr": {
                                "type": "value",
                                "value": "OTHER"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.date",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.data"
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.value",
                              "xpr": {
                                "type": "value",
                                "value": 0
                              }
                            },
                            {
                              "type": "set",
                              "prop": "transaction.fee",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.kwota"
                              },
                              "trfms": [
                                {
                                  "type": "negate"
                                }
                              ]
                            },
                            {
                              "type": "set",
                              "prop": "transaction.note",
                              "xpr": {
                                "type": "prop",
                                "prop": "cols.tytu≈Ç operacji"
                              }
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "xpr": {
                        "type": "or",
                        "xprs": [
                          {
                            "type": "pattern",
                            "xpr": {
                              "type": "prop",
                              "prop": "cols.tytu≈Ç operacji"
                            },
                            "pattern": "~Przelew ~^"
                          },
                          {
                            "type": "pattern",
                            "xpr": {
                              "type": "prop",
                              "prop": "cols.tytu≈Ç operacji"
                            },
                            "pattern": "~Zwrot nadp≈Çaty~^"
                          }
                        ]
                      },
                      "stmts": [
                        {
                          "type": "addRowNote",
                          "note": {
                            "type": "value",
                            "value": "üí∏ Cash transfers are [currently not imported](https://www.mycapitally.com/help/tracking-cash)"
                          }
                        }
                      ]
                    },
                    {
                      "xpr": {
                        "type": "pattern",
                        "xpr": {
                          "type": "prop",
                          "prop": "cols.tytu≈Ç operacji"
                        },
                        "pattern": "~Wymiana waluty~"
                      },
                      "stmts": [
                        {
                          "type": "addRowNote",
                          "note": {
                            "type": "value",
                            "value": "üí¥ Currency exchanges are currently not imported"
                          }
                        }
                      ]
                    },
                    {
                      "xpr": {
                        "type": "or",
                        "xprs": [
                          {
                            "type": "pattern",
                            "xpr": {
                              "type": "prop",
                              "prop": "cols.tytu≈Ç operacji"
                            },
                            "pattern": "~Wykup certyfikat√≥w ~^"
                          },
                          {
                            "type": "pattern",
                            "xpr": {
                              "type": "prop",
                              "prop": "cols.tytu≈Ç operacji"
                            },
                            "pattern": "~P≈Çatno≈õƒá bonusowa dotyczƒÖca likwidacji ~"
                          }
                        ]
                      },
                      "stmts": [
                        {
                          "type": "addRowNote",
                          "note": {
                            "type": "formula",
                            "formula": "=\"ü§ö One of your holdings was liquidated and you received it's value. There's no quantity provided by the broker, so you'll need to close this position manually with the provided value:\\n**\" + col(\"kwota\") + \"** for *\" + col(\"tytu≈Ç operacji\") +\"*\""
                          }
                        }
                      ]
                    },
                    {
                      "xpr": {
                        "type": "pattern",
                        "xpr": {
                          "type": "prop",
                          "prop": "cols.tytu≈Ç operacji"
                        },
                        "pattern": "~Podatek od odsetek~^"
                      },
                      "stmts": [
                        {
                          "type": "comment",
                          "md": "Ignore silently (already handled above)"
                        }
                      ]
                    },
                    {
                      "stmts": [
                        {
                          "type": "addRowNote",
                          "note": {
                            "type": "formula",
                            "formula": "=\"‚ö†Ô∏è Unknown operation `\" + col(\"tytu≈Ç operacji\") + \"`\""
                          },
                          "urgency": "warn"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "options": {
          "valueMap": {
            "asset": {}
          }
        }
      }
    }
  }
}
